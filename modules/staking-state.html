<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Staking states and transitions | Crypto.com Chain</title>
    <meta name="description" content="Welcome to Crypto.com Chain&#39;s documentation!">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.4c9036fb.css" as="style"><link rel="preload" href="/assets/js/app.87b9d60e.js" as="script"><link rel="preload" href="/assets/js/2.f6144b7e.js" as="script"><link rel="preload" href="/assets/js/32.63f06b33.js" as="script"><link rel="prefetch" href="/assets/js/10.1cdea379.js"><link rel="prefetch" href="/assets/js/11.b81d5b6e.js"><link rel="prefetch" href="/assets/js/12.ebcf529d.js"><link rel="prefetch" href="/assets/js/13.808bce9e.js"><link rel="prefetch" href="/assets/js/14.e2912e35.js"><link rel="prefetch" href="/assets/js/15.60461254.js"><link rel="prefetch" href="/assets/js/16.5fe5db6e.js"><link rel="prefetch" href="/assets/js/17.84cca1c2.js"><link rel="prefetch" href="/assets/js/18.825a3de8.js"><link rel="prefetch" href="/assets/js/19.f9142acf.js"><link rel="prefetch" href="/assets/js/20.3e73af9d.js"><link rel="prefetch" href="/assets/js/21.aba308fd.js"><link rel="prefetch" href="/assets/js/22.83321bcb.js"><link rel="prefetch" href="/assets/js/23.b04b2df4.js"><link rel="prefetch" href="/assets/js/24.681f9c6c.js"><link rel="prefetch" href="/assets/js/25.be3144a2.js"><link rel="prefetch" href="/assets/js/26.5db2f66c.js"><link rel="prefetch" href="/assets/js/27.25665eb5.js"><link rel="prefetch" href="/assets/js/28.70d083de.js"><link rel="prefetch" href="/assets/js/29.4727a189.js"><link rel="prefetch" href="/assets/js/3.c61d9941.js"><link rel="prefetch" href="/assets/js/30.d03015d5.js"><link rel="prefetch" href="/assets/js/31.c62e85d2.js"><link rel="prefetch" href="/assets/js/33.8ba9d6b5.js"><link rel="prefetch" href="/assets/js/34.c447f9e1.js"><link rel="prefetch" href="/assets/js/35.8491695c.js"><link rel="prefetch" href="/assets/js/36.14947c5d.js"><link rel="prefetch" href="/assets/js/37.4441c601.js"><link rel="prefetch" href="/assets/js/4.98fec9a1.js"><link rel="prefetch" href="/assets/js/5.dddf6e84.js"><link rel="prefetch" href="/assets/js/6.c42000b0.js"><link rel="prefetch" href="/assets/js/7.adda006a.js"><link rel="prefetch" href="/assets/js/8.a5d62fc4.js"><link rel="prefetch" href="/assets/js/9.7c0971f5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4c9036fb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Crypto.com Chain</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Thaler Testnet" class="dropdown-title"><span class="title">Thaler Testnet</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/getting-started/thaler-testnet.html" class="nav-link">
  Setup Tutorial
</a></li><li class="dropdown-item"><!----> <a href="https://chain.crypto.com/explorer" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Testnet Explorer
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://chain.crypto.com/explorer/faucet" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Testnet Faucet
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Wallet Management" class="dropdown-title"><span class="title">Wallet Management</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wallets/#client-cli" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><!----> <a href="/wallets/client-cli.html#client-cli" class="nav-link">
  Client CLI
</a></li><li class="dropdown-item"><!----> <a href="/wallets/sample-chain-wallet.html#sample-chain-wallet" class="nav-link">
  Sample Chain Wallet
</a></li><li class="dropdown-item"><!----> <a href="/wallets/client-rpc.html#client-rpc" class="nav-link">
  Client RPC
</a></li></ul></div></div><div class="nav-item"><a href="https://crypto-com.github.io/Crypto.com_Chain.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Download
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Thaler Testnet" class="dropdown-title"><span class="title">Thaler Testnet</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/getting-started/thaler-testnet.html" class="nav-link">
  Setup Tutorial
</a></li><li class="dropdown-item"><!----> <a href="https://chain.crypto.com/explorer" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Testnet Explorer
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://chain.crypto.com/explorer/faucet" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Testnet Faucet
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Wallet Management" class="dropdown-title"><span class="title">Wallet Management</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wallets/#client-cli" class="nav-link">
  Overview
</a></li><li class="dropdown-item"><!----> <a href="/wallets/client-cli.html#client-cli" class="nav-link">
  Client CLI
</a></li><li class="dropdown-item"><!----> <a href="/wallets/sample-chain-wallet.html#sample-chain-wallet" class="nav-link">
  Sample Chain Wallet
</a></li><li class="dropdown-item"><!----> <a href="/wallets/client-rpc.html#client-rpc" class="nav-link">
  Client RPC
</a></li></ul></div></div><div class="nav-item"><a href="https://crypto-com.github.io/Crypto.com_Chain.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Download
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="staking-states-and-transitions"><a href="#staking-states-and-transitions" class="header-anchor">#</a> Staking states and transitions</h1> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">struct</span> StakedState <span class="token punctuation">{</span>
    address<span class="token punctuation">:</span> StakedStateAddress<span class="token punctuation">,</span>
    nonce<span class="token punctuation">:</span> u64<span class="token punctuation">,</span>
    bonded<span class="token punctuation">:</span> Coin<span class="token punctuation">,</span>
    unbonded<span class="token punctuation">:</span> Coin<span class="token punctuation">,</span>
    unbonded_from<span class="token punctuation">:</span> Timespec<span class="token punctuation">,</span>
    validator<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span>Validator<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> Validator <span class="token punctuation">{</span>
    council_node<span class="token punctuation">:</span> CouncilNode<span class="token punctuation">,</span>
    jailed_until<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span>Timespec<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    inactive_time<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span>Timespec<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    used_validator_keys<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span><span class="token punctuation">(</span>TendermintValidatorPubKey<span class="token punctuation">,</span> Timespec<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="states"><a href="#states" class="header-anchor">#</a> States</h2> <h3 id="clean-staking"><a href="#clean-staking" class="header-anchor">#</a> Clean staking</h3> <p><code>validator.is_none()</code></p> <h3 id="validator"><a href="#validator" class="header-anchor">#</a> Validator</h3> <p><code>validator.is_some()</code></p> <p>There are several variants of it:</p> <h4 id="active"><a href="#active" class="header-anchor">#</a> Active</h4> <p><code>validator.inactive_time.is_none()</code></p> <blockquote><p><strong><em>NOTE:</em></strong> Active validator doesn't necessarily mean the final validator take effect in tendermint, please refer to
<a href="#choose-final-validators">Choose final validators</a></p></blockquote> <h4 id="inactive"><a href="#inactive" class="header-anchor">#</a> Inactive</h4> <p><code>validator.inactive_time.is_some()</code></p> <h4 id="jailed"><a href="#jailed" class="header-anchor">#</a> Jailed</h4> <p><code>validator.jailed_until.is_some()</code></p> <blockquote><p><strong><em>NOTE:</em></strong> Jailed implies inactive, but not vice versa</p></blockquote> <h2 id="state-transitions"><a href="#state-transitions" class="header-anchor">#</a> State transitions</h2> <h3 id="from-clean-staking-or-inactive-unjailed-validator-to-active-validator"><a href="#from-clean-staking-or-inactive-unjailed-validator-to-active-validator" class="header-anchor">#</a> From &quot;clean staking&quot; or &quot;inactive(unjailed) validator&quot; to active validator</h3> <h4 id="node-join"><a href="#node-join" class="header-anchor">#</a> Node join</h4> <p>The only way to transit to active validator is by executing <code>NodeJoinTx</code>, the preconditions are:</p> <ul><li><code>bonded &gt;= min_required_staking</code></li> <li>The validator pubkey/address is not already used by others, it's ok to re-use the old keys used by itself if it's a re-join from an inactive validator.</li> <li>Not jailed if transiting from inactive validator</li></ul> <h3 id="from-active-validator-to-inactive-validator"><a href="#from-active-validator-to-inactive-validator" class="header-anchor">#</a> From &quot;active validator&quot; to &quot;inactive validator&quot;</h3> <p>There are several cases for this:</p> <h4 id="bonded-coins-become-lower-than-required"><a href="#bonded-coins-become-lower-than-required" class="header-anchor">#</a> Bonded coins become lower than required</h4> <p>When <code>bonded &lt; min_required_staking</code>, this transition happens.</p> <p>The reasons for dropping of bonded coins maybe:</p> <ul><li>Execute <code>UnbondTx</code> at <code>deliver_tx</code> event</li> <li>Slashed for non-live or byzantine faults at <code>begin_block</code> event</li></ul> <blockquote><p><strong><em>NOTE:</em></strong> The transition happens immediately in <code>deliver_tx</code> or <code>begin_block</code> events, won't reverse automatically
when bonded coins become enough again even in the same block, so the activeness is always well-defined during the
whole process.</p></blockquote> <h4 id="jailed-for-byzantine-faults"><a href="#jailed-for-byzantine-faults" class="header-anchor">#</a> Jailed for byzantine faults</h4> <p>Jailed always implies inactive.</p> <p>This happens in <code>begin_block</code> event.</p> <h3 id="from-jailed-validator-to-inactive-unjailed-validator"><a href="#from-jailed-validator-to-inactive-unjailed-validator" class="header-anchor">#</a> From &quot;jailed validator&quot; to &quot;inactive(unjailed) validator&quot;</h3> <h4 id="unjail"><a href="#unjail" class="header-anchor">#</a> Unjail</h4> <p>The only way to leave jailed validator state is by executing <code>UnjailTx</code>, the preconditions are:</p> <ul><li>Already jailed</li> <li><code>block_time &gt;= jailed_until</code></li></ul> <h3 id="from-inactive-validator-to-clean-staking"><a href="#from-inactive-validator-to-clean-staking" class="header-anchor">#</a> From &quot;inactive validator&quot; to &quot;clean staking&quot;</h3> <h4 id="clean-up"><a href="#clean-up" class="header-anchor">#</a> Clean up</h4> <p>The clean up procedure will remove the validator record if:</p> <ul><li>Not jailed</li> <li><code>block_time &gt;= inactive_time + cleanup_period</code></li></ul> <blockquote><p><em><strong>NOTE:</strong></em> <code>cleanup_period</code></p> <p>Currently <code>cleanup_period = unbonding_period</code>, but logically, <code>cleanup_period</code> only needs such constraints:</p> <ul><li><code>&gt; max_evidence_age</code>, so we can handle delayed byzantine evidences (inactive validator can still be slashed for
later detected byzantine faults)</li> <li><code>&gt; 2 blocks</code>, so we don't panic when seeing signing vote of inactivated validators</li></ul></blockquote> <h2 id="appendix"><a href="#appendix" class="header-anchor">#</a> Appendix</h2> <h3 id="choose-final-validators"><a href="#choose-final-validators" class="header-anchor">#</a> Choose final validators</h3> <p>The final validator set that take effect in tendermint is chosen at <code>end_block</code> event by:</p> <ul><li>Sort all the active validators by <code>voting_power desc, staking_address</code></li> <li>Take the first <code>max_validators</code> ones</li></ul> <p>The abci protocol of <code>end_block</code> event expect validator set updates in response, so we need to diff the new set against
the current set to get the updates.</p> <p>For example, assuming <code>max_validators = 3</code>, if you are the fourth active validator, so you are not chosen yet, but in
the future if any validator in the top 3 quit, you will be chosen automatically at the next <code>end_block</code> event:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>max_validators = 3

<span class="token key atrule">genesis</span><span class="token punctuation">:</span>
  validators (map of validator address to voting power)<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> addr1 <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> 10
  <span class="token punctuation">-</span> addr2 <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> 9

<span class="token key atrule">block1</span><span class="token punctuation">:</span>
  deliver_tx
  <span class="token punctuation">-</span> join_node(addr3<span class="token punctuation">,</span> 8)
  <span class="token punctuation">-</span> join_node(addr4<span class="token punctuation">,</span> 7)
  active validators<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> addr1 <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> 10
  <span class="token punctuation">-</span> addr2 <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> 9
  <span class="token punctuation">-</span> addr3 <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> 8
  <span class="token punctuation">-</span> addr4 <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> 7
  end_block validator updates<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> addr3 <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> 8

<span class="token key atrule">block2</span><span class="token punctuation">:</span>
  <span class="token key atrule">deliver_tx</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> unbond_all(addr1)
  active validators<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> addr2 <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> 9
  <span class="token punctuation">-</span> addr3 <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> 8
  <span class="token punctuation">-</span> addr4 <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> 7
  end_block validator updates<span class="token punctuation">:</span>
  <span class="token punctuation">-</span> addr1 <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> 0
  <span class="token punctuation">-</span> addr4 <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> 7
</code></pre></div><h3 id="implications-of-jailing"><a href="#implications-of-jailing" class="header-anchor">#</a> Implications of jailing</h3> <h4 id="transactions"><a href="#transactions" class="header-anchor">#</a> Transactions</h4> <p>Only <code>UnjailTx</code> is allowed to be executed on a jailed staking if the <code>jailed_until</code> time is passed.</p> <p>Disallowed transactions are:</p> <ul><li><code>DepositTx</code></li> <li><code>WithdrawTx</code></li> <li><code>UnbondTx</code></li> <li><code>NodeJoinTx</code></li></ul> <h4 id="reward-distribution"><a href="#reward-distribution" class="header-anchor">#</a> Reward distribution</h4> <p>It won't distribute rewards to jailed validators, inactive(unjailed) validators will get the rewards as normal.</p> <p>When a validator is jailed, it's reward participation tracking records are removed immediately.</p> <h4 id="process-byzantine-faults"><a href="#process-byzantine-faults" class="header-anchor">#</a> Process byzantine faults</h4> <p>Jailed validators won't be slashed again for byzantine faults detected in jailing period.</p> <h3 id="nonce"><a href="#nonce" class="header-anchor">#</a> Nonce</h3> <p>The nonce is the number of transactions that have the witness of the staking address, which includes:</p> <ul><li><code>WithdrawTx</code></li> <li><code>UnbondTx</code></li> <li><code>UnjailTx</code></li> <li><code>NodeJoinTx</code></li></ul> <h3 id="liveness-tracking"><a href="#liveness-tracking" class="header-anchor">#</a> Liveness tracking</h3> <ul><li><p>All active validators's liveness trackers are maintained no matter if it's chosen into the <a href="#choose-final-validators">final validator set</a>.</p> <p>If it doesn't appear in the votes reported by tendermint, it's recorded as a <code>true</code> which means live by default.</p></li> <li><p>Inactive validator's liveness trackers are also maintained, and recorded as a <code>true</code> for each block, this serves two purposes:</p> <ul><li>After a validator inactivated, the signing vote might still arrive for the next two blocks, we don't want to issue a
false warning in this case.</li> <li>Validator might quit and re-join very fast (by <code>UnbondTx</code>/<code>DepositTx</code>/<code>NodeJoinTx</code>), in this case it's liveness
tracking record is preserved.</li></ul></li></ul> <p>It means the liveness tracker is only removed when validator record get <a href="#clean-up">cleaned up</a>.</p> <h3 id="inactive-validator-re-join-with-different-validator-key"><a href="#inactive-validator-re-join-with-different-validator-key" class="header-anchor">#</a> Inactive validator re-join with different validator key</h3> <p>When an inactive validator re-join, it can provide different validator key, but it still needs to be hold responsible for
byzantine fault committed before for as long as <code>max_evidence_age</code>. So we need to keep the old validator keys for
sometime.</p> <p>Whenever validator change consensus key, the old key and current block time are pushed into <code>used_validator_keys</code>, before that, the used keys older than <code>max_evidence_age</code> are removed.</p> <p>There is a maximum bound (<code>max_used_validator_keys</code>) on the size of <code>used_validator_keys</code> to prevent attack. After the maximum bound reached, re-join with new validator key is not allowed.</p> <h3 id="non-exists-and-empty-staking"><a href="#non-exists-and-empty-staking" class="header-anchor">#</a> Non exists and empty staking</h3> <p>Empty staking is defined as:</p> <div class="language-rust extra-class"><pre class="language-rust"><code>StakedState <span class="token punctuation">{</span>
    address<span class="token punctuation">,</span>
    nonce<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    bonded<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    unbonded<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    unbonded_from<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    validator<span class="token punctuation">:</span> None<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For all the logic processing, the result of success execution should be the same for both non exists staking and empty staking.</p> <p>The error message for failed execution maybe different, for example <code>WithdrawTx</code> might report <code>StakingNotExists</code> on non
exists staking, but <code>CoinError</code> on empty staking.</p> <p>So the implementor should be free to choose either semantics.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.87b9d60e.js" defer></script><script src="/assets/js/2.f6144b7e.js" defer></script><script src="/assets/js/32.63f06b33.js" defer></script>
  </body>
</html>
